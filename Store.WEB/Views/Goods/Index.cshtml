@model IEnumerable<Store.WEB.Models.GoodViewModel>

@{
    ViewBag.Title = "Index";
}

@using (Ajax.BeginForm("GoodsSearch", new AjaxOptions()
{
    UpdateTargetId = "result",
    Url = Url.Action("GoodsSearch")
}))
{
    <div style="background: ; float: ;" class="input-group">
        <fieldset style="background: ; float: right; ">
            <legend>Фильтр</legend>
            <div style="background: ; float: right; ">

                Цена:
                @Html.Editor("PriceFrom", new { htmlAttributes = new { @class = "form-control", style = "width: 80px; ", placeholder = "от" } })
                @Html.Editor("PriceTo", new { htmlAttributes = new { @class = "form-control", style = "width: 80px; ", placeholder = "до" } })
                
                Цвет:
                @Html.DropDownList("ColorId", ViewBag.Colors as List<SelectListItem>, new { @class = "btn btn-default dropdown-toggle" })
                <br />
                <br />

                Размер:
                от
                <input class="sizeInput form-control" style="width: 50px" type="text" placeholder="Выс." name="SizeHFrom" />
                <input class="sizeInput form-control" style="width: 50px" type="text" placeholder="Шир." name="SizeWFrom" />
                <input class="sizeInput form-control" style="width: 50px" type="text" placeholder="Глуб." name="SizeDFrom" />
                до
                <input class="sizeInput form-control" style="width: 50px" type="text" placeholder="Выс." name="SizeHTo" />
                <input class="sizeInput form-control" style="width: 50px" type="text" placeholder="Шир." name="SizeWTo" />
                <input class="sizeInput form-control" style="width: 50px" type="text" placeholder="Глуб." name="SizeDTo" />

                Категория:
                @Html.DropDownList("CategoryId", ViewBag.Categories as List<SelectListItem>, new { @class = "btn btn-default dropdown-toggle" })
                <input class="btn btn-primary" style="float: right" type="submit" value="Фильтровать" />
            </div>

            <div class="input-group" style="padding:5px">
                <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit">Поиск</button>
                </span>
                <input type="text" class="form-control" name="search" placeholder="Введите запрос...">
            </div>

        </fieldset>
    </div>
}
<hr />

@using (Ajax.BeginForm("GoodsSearch", new AjaxOptions()
{
    UpdateTargetId = "result",
    Url = Url.Action("GoodsSearch"),
    OnSuccess = "ParseJson"
}))
{

}

<div style="clear: both;" id="result">
    @Html.Action("GoodsSearch")
</div>

@*<table class="table">
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Image)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Description)
            </th>

            <th>
                @Html.DisplayNameFor(model => model.Count)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.SizeWidth)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.SizeHeight)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.SizeDepth)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.PriceSale)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Category)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Color)
            </th>
            <th></th>
        </tr>

        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @if (item.Image != null)
                    {
                        <div class="pull-left" style="margin-right: 10px">
                            <img class="img-thumbnail" width="75" height="75"
                                 src="@Url.Action("GetImage", "Goods", new { item.Id })" />
                        </div>
                    }
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Description)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Count)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.SizeWidth)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.SizeHeight)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.SizeDepth)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.PriceSale)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Category)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Color)
                </td>
                <td>
                    @Html.ActionLink("В корзину", "Create", "OrderItems", new { id = item.Id }, null) |
                    @Html.ActionLink("Подробнее", "Details", new { id = item.Id })
                    <br />
                    @Html.ActionLink("Редактировать", "Edit", new { id = item.Id }) |
                    @Html.ActionLink("Удалить", "Delete", new { id = item.Id })
                </td>
            </tr>
        }

    </table>*@
@*<div style="overflow:hidden" id="">
        @foreach (var item in Model)
        {
            <div class="item">
                <div class="img">
                    @if (item.Image != null)
                    {
                        <div class="pull-left" style="margin-right: 10px">
                            <img class="img-thumbnail" width="110" height="110"
                                 src="@Url.Action("GetImage", "Goods", new {item.Id})" />
                        </div>
                    }
                </div>
                <div class="text">
                    <h4>@item.Name</h4>
                    @item.Description
                    <h4>@item.PriceSale грн @Html.ActionLink("В корзину", "AddToCart","Cart", new { goodId = item.Id }, null)</h4>
                    @Html.ActionLink("Подробнее", "Details", "Goods", new { id = item.Id }, null)
                </div>
            </div>
        }

    </div>*@

<script type="text/javascript">

    function ParseJson(data) {
        var target = $("#result");
        target.empty();

        if (data.length == 0) {
            target.append("Результатов нет<br>Попробуй еще!");
        } else {

            target.append("<tr>+" +
                "<th>@Html.DisplayNameFor(model => model.Name)</th>" +
                "<th>@Html.DisplayNameFor(model => model.Image)</th>" +
                "<th>@Html.DisplayNameFor(model => model.Description)</th>" +
                "<th>@Html.DisplayNameFor(model => model.PriceSale)</th>" +
                "<th>@Html.DisplayNameFor(model => model.Category)</th>" +
                "<th>@Html.DisplayNameFor(model => model.Color)</th>" +
                "<th>@Html.DisplayNameFor(model => model.Count)</th>" +
                "<th>@Html.DisplayNameFor(model => model.Date)</th>" +
                "<th></th>" +
                "</tr>");

            for (var i = 0; i < data.length; i++) {
                var date = new Date(parseInt(data[i].Date.replace("/Date(", "").replace(")/", ""), 10)).toLocaleString();

                target.append("<tr>+" +
                    "<td><b>" + data[i].Name + "</b></td>" +
                    "<td></td>" +
                     "<td></td>" +
                    //"<td>" + data[i].Image + "</td>" +
                    //"<td>     <img class=\"img-thumbnail\" width=\"75\" height=\"75\" src=\""+src+"\" /></td>" +
                    "<td>" + data[i].Description + "</td>" +
                    "<td>" + data[i].PriceSale + "</td>" +
                    "<td>" + data[i].Category + "</td>" +
                    "<td>" + data[i].Color + "</td>" +
                    "<td>" + data[i].Count + "</td>+" +
                    "<td>" + date + "</td>" +
                         "<td><a href=http://localhost:58338/OrderItems/Create/" + data[i].Id + ">Buy</a></td>" +
                    "</tr>");

                @*<div class="item">
                    <h3>@Model.Name</h3>
                    @Model.Description
                    @using (Html.BeginForm("AddToCart", "Cart")) {
                    @Html.HiddenFor(x => x.ProductID)
                    @Html.Hidden("returnUrl", Request.Url.PathAndQuery)
                    <input type="submit" value="+ Add to cart" />
                                    }
                    <h4>@Model.Price.ToString("c")</h4>
                </div>*@
            }
        }
    }
</script>

@section Scripts {
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
}